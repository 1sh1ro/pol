<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Proof of Love - AIæ™ºèƒ½è¯„å®¡ç³»ç»Ÿ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/ethers@6.7.1/dist/ethers.min.js"></script>
    <style>
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .floating { animation: float 6s ease-in-out infinite; }
        .pulse { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }

        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .ai-gradient {
            background: linear-gradient(135deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
        }

        .text-gradient {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .success-toast {
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .card-hover {
            transition: all 0.3s ease;
        }

        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }

        .loading-spinner {
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top: 3px solid white;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .progress-bar {
            transition: width 0.3s ease;
        }

        .ai-thinking {
            position: relative;
            overflow: hidden;
        }

        .ai-thinking::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .judgment-card {
            background: linear-gradient(135deg, rgba(78, 205, 196, 0.1), rgba(69, 183, 209, 0.1));
            border: 1px solid rgba(78, 205, 196, 0.3);
            backdrop-filter: blur(10px);
        }

        .score-circle {
            position: relative;
            width: 120px;
            height: 120px;
        }

        .score-circle svg {
            transform: rotate(-90deg);
        }

        .score-circle circle {
            fill: none;
            stroke-width: 8;
        }

        .score-circle .bg {
            stroke: rgba(255,255,255,0.1);
        }

        .score-circle .progress {
            stroke-dasharray: 314;
            stroke-dashoffset: 314;
            transition: stroke-dashoffset 1s ease;
        }

        .category-score {
            transition: all 0.3s ease;
        }

        .category-score:hover {
            transform: translateX(5px);
        }

        .ai-badge {
            background: linear-gradient(135deg, #ff6b6b, #4ecdc4);
            animation: gradientShift 3s ease infinite;
        }
    </style>
</head>
<body class="bg-gray-900 text-white">
    <!-- Background Effects -->
    <div class="fixed inset-0 overflow-hidden pointer-events-none">
        <div class="absolute -top-40 -right-40 w-80 h-80 bg-purple-500 rounded-full mix-blend-multiply filter blur-xl opacity-20 floating"></div>
        <div class="absolute -bottom-40 -left-40 w-80 h-80 bg-pink-500 rounded-full mix-blend-multiply filter blur-xl opacity-20 floating" style="animation-delay: 2s;"></div>
        <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-80 h-80 bg-blue-500 rounded-full mix-blend-multiply filter blur-xl opacity-20 floating" style="animation-delay: 4s;"></div>
    </div>

    <!-- Toast Container -->
    <div id="toastContainer" class="fixed top-4 right-4 z-50 space-y-2"></div>

    <!-- Navigation -->
    <nav class="relative z-10 bg-gray-900/80 backdrop-blur-md border-b border-gray-700">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-gradient-to-br from-purple-500 to-pink-500 rounded-lg flex items-center justify-center">
                        <i class="fas fa-heart text-white"></i>
                    </div>
                    <span class="text-xl font-bold">Proof of Love</span>
                    <div class="ai-badge px-2 py-1 rounded-full text-xs font-bold">
                        <i class="fas fa-robot mr-1"></i>AIè¯„å®¡
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="text-sm text-gray-400">
                        <i class="fas fa-coins text-purple-400 mr-1"></i>
                        <span id="polBalance">0</span> PoL
                    </div>
                    <div class="text-sm text-gray-400">
                        <i class="fas fa-brain text-cyan-400 mr-1"></i>
                        <span id="aiJudgments">0</span> AIè¯„å®¡
                    </div>
                    <button id="connectWallet" class="bg-purple-600 hover:bg-purple-700 px-6 py-2 rounded-full transition">
                        è¿æ¥é’±åŒ…
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="relative z-10 min-h-screen">
        <!-- Hero Section -->
        <section class="py-12 px-4">
            <div class="max-w-7xl mx-auto text-center">
                <h1 class="text-3xl font-bold mb-4">
                    <span class="text-gradient">Proof of Love</span>
                    <br>
                    <span class="text-xl text-gray-300">AIæ™ºèƒ½è´¡çŒ®è¯„å®¡ç³»ç»Ÿ</span>
                </h1>
                <p class="text-base text-gray-300 mb-6">
                    é›†æˆDeepSeekå¤§æ¨¡å‹ï¼Œä¸ºæ‚¨çš„è´¡çŒ®æä¾›ä¸“ä¸šçš„AIè¯„å®¡å’Œè´¨é‡è¯„ä¼°
                </p>
            </div>
        </section>

        <!-- AI Judge Status -->
        <section class="px-4 pb-8">
            <div class="max-w-7xl mx-auto">
                <div class="bg-gradient-to-r from-cyan-600/20 to-teal-600/20 border border-cyan-500/30 rounded-2xl p-6">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-4">
                            <div class="w-12 h-12 bg-cyan-500/20 rounded-xl flex items-center justify-center">
                                <i class="fas fa-robot text-cyan-400 text-xl"></i>
                            </div>
                            <div>
                                <h3 class="font-semibold text-cyan-400">DeepSeek AIè¯„å®¡åŠ©æ‰‹</h3>
                                <p class="text-sm text-gray-400">åŸºäºæ·±åº¦å­¦ä¹ çš„æ™ºèƒ½è´¡çŒ®è´¨é‡è¯„ä¼°ç³»ç»Ÿ</p>
                            </div>
                        </div>
                        <div class="flex items-center space-x-6">
                            <div class="text-center">
                                <div class="text-2xl font-bold text-cyan-400" id="totalJudged">0</div>
                                <div class="text-xs text-gray-400">æ€»è¯„å®¡æ•°</div>
                            </div>
                            <div class="text-center">
                                <div class="text-2xl font-bold text-green-400" id="avgScore">0</div>
                                <div class="text-xs text-gray-400">å¹³å‡å¾—åˆ†</div>
                            </div>
                            <div class="text-center">
                                <div class="text-2xl font-bold text-purple-400" id="aiAccuracy">95%</div>
                                <div class="text-xs text-gray-400">AIå‡†ç¡®ç‡</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Contribution Submission with AI Judge -->
        <section class="px-4 pb-16">
            <div class="max-w-7xl mx-auto">
                <div class="bg-gray-800/50 backdrop-blur-sm rounded-2xl border border-gray-700 p-8">
                    <h2 class="text-2xl font-bold mb-6">
                        <i class="fas fa-brain text-cyan-400 mr-2"></i>AIæ™ºèƒ½è´¡çŒ®æäº¤
                    </h2>

                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                        <!-- å·¦ä¾§ï¼šè´¡çŒ®è¡¨å• -->
                        <div class="lg:col-span-2">
                            <div class="space-y-6">
                                <!-- è´¡çŒ®ç±»å‹ -->
                                <div>
                                    <h3 class="text-lg font-semibold mb-4">é€‰æ‹©è´¡çŒ®ç±»å‹</h3>
                                    <div class="grid grid-cols-2 gap-3">
                                        <label class="contribution-type-card flex items-center p-4 bg-gray-700/50 rounded-lg cursor-pointer hover:bg-gray-700 transition border-2 border-transparent hover:border-purple-500" data-type="education">
                                            <input type="radio" name="contributionType" value="education" class="mr-3" checked>
                                            <div>
                                                <div class="font-medium">ğŸ“š æ•™è‚²å†…å®¹</div>
                                                <div class="text-xs text-gray-400">æ•™ç¨‹ã€æ–‡æ¡£ã€è§†é¢‘</div>
                                            </div>
                                        </label>
                                        <label class="contribution-type-card flex items-center p-4 bg-gray-700/50 rounded-lg cursor-pointer hover:bg-gray-700 transition border-2 border-transparent hover:border-purple-500" data-type="code">
                                            <input type="radio" name="contributionType" value="code" class="mr-3">
                                            <div>
                                                <div class="font-medium">ğŸ’» ä»£ç è´¡çŒ®</div>
                                                <div class="text-xs text-gray-400">PRã€Bugä¿®å¤ã€åŠŸèƒ½</div>
                                            </div>
                                        </label>
                                        <label class="contribution-type-card flex items-center p-4 bg-gray-700/50 rounded-lg cursor-pointer hover:bg-gray-700 transition border-2 border-transparent hover:border-purple-500" data-type="research">
                                            <input type="radio" name="contributionType" value="research" class="mr-3">
                                            <div>
                                                <div class="font-medium">ğŸ”¬ ç ”ç©¶åˆ†æ</div>
                                                <div class="text-xs text-gray-400">æ·±åº¦åˆ†æã€æŠ¥å‘Š</div>
                                            </div>
                                        </label>
                                        <label class="contribution-type-card flex items-center p-4 bg-gray-700/50 rounded-lg cursor-pointer hover:bg-gray-700 transition border-2 border-transparent hover:border-purple-500" data-type="community">
                                            <input type="radio" name="contributionType" value="community" class="mr-3">
                                            <div>
                                                <div class="font-medium">ğŸ‘¥ ç¤¾åŒºå»ºè®¾</div>
                                                <div class="text-xs text-gray-400">ç»„ç»‡ã€ç¿»è¯‘ã€æ”¯æŒ</div>
                                            </div>
                                        </label>
                                    </div>
                                </div>

                                <!-- è´¡çŒ®è¯¦æƒ… -->
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-sm font-medium mb-2">è´¡çŒ®æ ‡é¢˜ *</label>
                                        <input type="text" id="contributionTitle" class="w-full p-3 bg-gray-700 border border-gray-600 rounded-lg text-white" placeholder="ç»™ä½ çš„è´¡çŒ®èµ·ä¸ªç®€æ´æ˜ç¡®çš„æ ‡é¢˜...">
                                    </div>

                                    <div>
                                        <label class="block text-sm font-medium mb-2">è¯¦ç»†æè¿° *</label>
                                        <textarea id="contributionDesc" rows="6" class="w-full p-3 bg-gray-700 border border-gray-600 rounded-lg text-white" placeholder="è¯¦ç»†æè¿°ä½ çš„è´¡çŒ®å†…å®¹ï¼ŒåŒ…æ‹¬ï¼š&#10;1. å…·ä½“åšäº†ä»€ä¹ˆ&#10;2. è§£å†³äº†ä»€ä¹ˆé—®é¢˜&#10;3. äº§ç”Ÿäº†ä»€ä¹ˆå½±å“&#10;4. ä½¿ç”¨çš„æŠ€æœ¯å’Œæ–¹æ³•&#10;5. é¢„æœŸçš„é•¿æœŸä»·å€¼"></textarea>
                                        <div class="text-xs text-gray-400 mt-1">
                                            <i class="fas fa-info-circle mr-1"></i>
                                            è¯¦ç»†æè¿°æœ‰åŠ©äºAIæ›´å‡†ç¡®åœ°è¯„ä¼°è´¡çŒ®è´¨é‡
                                        </div>
                                    </div>

                                    <div>
                                        <label class="block text-sm font-medium mb-2">æŠ€æœ¯æ ˆ / å·¥å…·</label>
                                        <input type="text" id="techStack" class="w-full p-3 bg-gray-700 border border-gray-600 rounded-lg text-white" placeholder="ä¾‹å¦‚ï¼šReact, Solidity, Rust, Polkadot.js...">
                                    </div>

                                    <div>
                                        <label class="block text-sm font-medium mb-2">ç›¸å…³é“¾æ¥</label>
                                        <input type="text" id="contributionLink" class="w-full p-3 bg-gray-700 border border-gray-600 rounded-lg text-white" placeholder="GitHubé“¾æ¥ã€æ–‡æ¡£é“¾æ¥ã€æ¼”ç¤ºåœ°å€ç­‰...">
                                    </div>

                                    <div>
                                        <label class="block text-sm font-medium mb-2">é¢„æœŸå½±å“ *</label>
                                        <select id="expectedImpact" class="w-full p-3 bg-gray-700 border border-gray-600 rounded-lg text-white">
                                            <option value="">è¯·é€‰æ‹©é¢„æœŸå½±å“çº§åˆ«</option>
                                            <option value="personal">ä¸ªäººå­¦ä¹ æˆé•¿</option>
                                            <option value="team">å›¢é˜Ÿ/å°èŒƒå›´å½±å“</option>
                                            <option value="community">ç¤¾åŒºå±‚é¢å½±å“</option>
                                            <option value="ecosystem">ç”Ÿæ€ç³»ç»Ÿå½±å“</option>
                                            <option value="industry">è¡Œä¸šçº§å½±å“</option>
                                        </select>
                                    </div>
                                </div>

                                <!-- AIè¯„å®¡é€‰é¡¹ -->
                                <div class="bg-cyan-600/10 border border-cyan-500/30 rounded-lg p-4">
                                    <div class="flex items-center justify-between mb-2">
                                        <h4 class="font-semibold text-cyan-400">
                                            <i class="fas fa-robot mr-2"></i>AIæ™ºèƒ½è¯„å®¡
                                        </h4>
                                        <label class="flex items-center">
                                            <input type="checkbox" id="enableAIJudge" checked class="mr-2">
                                            <span class="text-sm">å¯ç”¨AIè¯„å®¡</span>
                                        </label>
                                    </div>
                                    <p class="text-sm text-gray-300">
                                        AIå°†ä»æŠ€æœ¯è´¨é‡ã€åˆ›æ–°æ€§ã€å®ç”¨ä»·å€¼ã€ç¤¾åŒºå½±å“ç­‰å¤šä¸ªç»´åº¦å¯¹æ‚¨çš„è´¡çŒ®è¿›è¡Œä¸“ä¸šè¯„ä¼°ï¼Œå¹¶æä¾›æ”¹è¿›å»ºè®®ã€‚
                                    </p>
                                </div>

                                <button onclick="submitWithAIJudge()" class="w-full px-6 py-3 bg-gradient-to-r from-cyan-600 to-teal-600 rounded-full font-semibold hover:from-cyan-700 hover:to-teal-700 transition transform hover:scale-105">
                                    <i class="fas fa-robot mr-2"></i>æäº¤å¹¶è¯·æ±‚AIè¯„å®¡
                                </button>
                            </div>
                        </div>

                        <!-- å³ä¾§ï¼šAIè¯„å®¡ç»“æœ -->
                        <div class="lg:col-span-1">
                            <div id="aiJudgeResult" class="judgment-card rounded-lg p-6 min-h-[400px]">
                                <h3 class="text-lg font-semibold mb-4 text-cyan-400">
                                    <i class="fas fa-brain mr-2"></i>AIè¯„å®¡ç»“æœ
                                </h3>
                                <div id="judgePlaceholder" class="text-center py-12">
                                    <i class="fas fa-robot text-6xl text-gray-600 mb-4"></i>
                                    <p class="text-gray-400">æäº¤è´¡çŒ®åï¼ŒAIå°†åœ¨è¿™é‡Œæ˜¾ç¤ºè¯¦ç»†è¯„ä¼°ç»“æœ</p>
                                </div>
                                <div id="judgeContent" class="hidden">
                                    <!-- AIè¯„å®¡ç»“æœå°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- AIè¯„å®¡å†å² -->
        <section class="px-4 pb-16">
            <div class="max-w-7xl mx-auto">
                <div class="bg-gray-800/50 backdrop-blur-sm rounded-2xl border border-gray-700 p-8">
                    <h2 class="text-2xl font-bold mb-6">
                        <i class="fas fa-history text-cyan-400 mr-2"></i>AIè¯„å®¡å†å²
                    </h2>
                    <div id="judgeHistory" class="space-y-4">
                        <div class="text-center text-gray-400 py-8">
                            <i class="fas fa-inbox text-4xl mb-3"></i>
                            <p>æš‚æ— AIè¯„å®¡è®°å½•</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <script>
        // DeepSeek APIé…ç½®
        const DEEPSEEK_API_URL = 'https://api.deepseek.com/chat/completions';
        const DEEPSEEK_API_KEY = '';

        // å…¨å±€çŠ¶æ€
        const appState = {
            isWalletConnected: false,
            balance: 0,
            contributions: [],
            aiJudgments: [],
            totalJudged: 0,
            avgScore: 0
        };

        // è´¡çŒ®ç±»å‹ä¸­è‹±æ–‡æ˜ å°„
        const contributionTypes = {
            education: 'æ•™è‚²å†…å®¹',
            code: 'ä»£ç è´¡çŒ®',
            research: 'ç ”ç©¶åˆ†æ',
            community: 'ç¤¾åŒºå»ºè®¾'
        };

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        function initializeApp() {
            setupEventListeners();
            updateUI();
        }

        function setupEventListeners() {
            document.getElementById('connectWallet').addEventListener('click', toggleWallet);
            document.querySelectorAll('input[name="contributionType"]').forEach(radio => {
                radio.addEventListener('change', updateContributionTypeCards);
            });
            updateContributionTypeCards();
        }

        // é’±åŒ…è¿æ¥
        async function toggleWallet() {
            const btn = document.getElementById('connectWallet');

            if (!appState.isWalletConnected) {
                btn.innerHTML = '<div class="loading-spinner inline-block mr-2"></div>è¿æ¥ä¸­...';
                btn.disabled = true;

                await simulateAsync(2000);

                appState.isWalletConnected = true;
                appState.balance = Math.floor(Math.random() * 2000) + 500;
                appState.userAddress = '0x' + Math.random().toString(16).substr(2, 8) + '...';

                btn.innerHTML = `<i class="fas fa-wallet mr-2"></i>${appState.userAddress}`;
                btn.disabled = false;
                btn.classList.remove('bg-purple-600', 'hover:bg-purple-700');
                btn.classList.add('bg-green-600', 'hover:bg-green-700');

                showToast('é’±åŒ…è¿æ¥æˆåŠŸï¼', 'success');
                updateUI();
            } else {
                appState.isWalletConnected = false;
                appState.balance = 0;

                btn.innerHTML = 'è¿æ¥é’±åŒ…';
                btn.classList.remove('bg-green-600', 'hover:bg-green-700');
                btn.classList.add('bg-purple-600', 'hover:bg-purple-700');

                showToast('é’±åŒ…å·²æ–­å¼€è¿æ¥', 'info');
                updateUI();
            }
        }

        // æ›´æ–°è´¡çŒ®ç±»å‹å¡ç‰‡æ ·å¼
        function updateContributionTypeCards() {
            document.querySelectorAll('.contribution-type-card').forEach(card => {
                const radio = card.querySelector('input[type="radio"]');
                if (radio.checked) {
                    card.classList.add('border-purple-500', 'bg-purple-600/20');
                } else {
                    card.classList.remove('border-purple-500', 'bg-purple-600/20');
                }
            });
        }

        // æäº¤è´¡çŒ®å¹¶è¯·æ±‚AIè¯„å®¡
        async function submitWithAIJudge() {
            if (!appState.isWalletConnected) {
                showToast('è¯·å…ˆè¿æ¥é’±åŒ…', 'error');
                return;
            }

            const enableAI = document.getElementById('enableAIJudge').checked;
            const title = document.getElementById('contributionTitle').value.trim();
            const desc = document.getElementById('contributionDesc').value.trim();
            const techStack = document.getElementById('techStack').value.trim();
            const link = document.getElementById('contributionLink').value.trim();
            const impact = document.getElementById('expectedImpact').value;
            const type = document.querySelector('input[name="contributionType"]:checked').value;

            // è¡¨å•éªŒè¯
            if (!title || !desc || !impact) {
                showToast('è¯·å¡«å†™æ‰€æœ‰å¿…å¡«å­—æ®µ', 'error');
                return;
            }

            if (desc.length < 50) {
                showToast('è´¡çŒ®æè¿°è‡³å°‘éœ€è¦50ä¸ªå­—ç¬¦', 'error');
                return;
            }

            // æ˜¾ç¤ºAIæ€è€ƒçŠ¶æ€
            if (enableAI) {
                showAIThinking();
            }

            try {
                let aiResult = null;
                if (enableAI) {
                    aiResult = await callDeepSeekAI({
                        title,
                        description: desc,
                        type: contributionTypes[type],
                        techStack,
                        link,
                        expectedImpact: impact
                    });
                }

                // ä¿å­˜è´¡çŒ®è®°å½•
                const contribution = {
                    id: Date.now(),
                    title,
                    description: desc,
                    type,
                    techStack,
                    link,
                    expectedImpact: impact,
                    timestamp: new Date(),
                    aiResult,
                    status: enableAI ? 'ai_judged' : 'pending'
                };

                appState.contributions.push(contribution);
                if (aiResult) {
                    appState.aiJudgments.push({
                        contributionId: contribution.id,
                        ...aiResult,
                        timestamp: new Date()
                    });
                    appState.totalJudged++;
                    updateAvgScore();
                }

                // æ›´æ–°UI
                if (enableAI && aiResult) {
                    displayAIResult(aiResult);
                    calculateAndAwardTokens(aiResult.score);
                    addToJudgeHistory(contribution, aiResult);
                } else {
                    showPendingResult();
                    // åŸºç¡€å¥–åŠ±
                    const baseReward = Math.floor(Math.random() * 200) + 100;
                    appState.balance += baseReward;
                    showToast(`è´¡çŒ®æäº¤æˆåŠŸï¼è·å¾—åŸºç¡€å¥–åŠ± ${baseReward} PoL`, 'success');
                }

                updateUI();
                clearForm();

            } catch (error) {
                console.error('AIè¯„å®¡å¤±è´¥:', error);
                showToast('AIè¯„å®¡æœåŠ¡æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·ç¨åé‡è¯•', 'error');
                showJudgeError();
            }
        }

        // è°ƒç”¨DeepSeek API
        async function callDeepSeekAI(contribution) {
            const prompt = `è¯·ä½œä¸ºä¸“ä¸šçš„åŒºå—é“¾å’Œå¼€æºç¤¾åŒºè´¡çŒ®è¯„å®¡ä¸“å®¶ï¼Œå¯¹ä»¥ä¸‹è´¡çŒ®è¿›è¡Œå…¨é¢è¯„ä¼°ï¼š

**è´¡çŒ®ä¿¡æ¯ï¼š**
- æ ‡é¢˜ï¼š${contribution.title}
- ç±»å‹ï¼š${contribution.type}
- æŠ€æœ¯æ ˆï¼š${contribution.techStack || 'æœªæŒ‡å®š'}
- é¢„æœŸå½±å“ï¼š${contribution.expectedImpact}
- ç›¸å…³é“¾æ¥ï¼š${contribution.link || 'æ— '}

**è¯¦ç»†æè¿°ï¼š**
${contribution.description}

è¯·ä»ä»¥ä¸‹ç»´åº¦è¿›è¡Œè¯„åˆ†ï¼ˆ0-100åˆ†ï¼‰ï¼š
1. æŠ€æœ¯è´¨é‡ - ä»£ç /å†…å®¹çš„æŠ€æœ¯æ°´å¹³ã€è§„èŒƒæ€§ã€æœ€ä½³å®è·µ
2. åˆ›æ–°æ€§ - æ˜¯å¦æœ‰ç‹¬ç‰¹çš„æ€è·¯æˆ–è§£å†³æ–¹æ¡ˆ
3. å®ç”¨ä»·å€¼ - å®é™…åº”ç”¨ä»·å€¼å’Œè§£å†³é—®é¢˜çš„èƒ½åŠ›
4. ç¤¾åŒºå½±å“ - å¯¹ç¤¾åŒºå’Œç”Ÿæ€ç³»ç»Ÿçš„ç§¯æå½±å“
5. å®Œæ•´æ€§ - è´¡çŒ®çš„å®Œæ•´åº¦å’Œå¯ç»´æŠ¤æ€§

è¯·ä»¥JSONæ ¼å¼è¿”å›è¯„ä¼°ç»“æœï¼š
{
  "overall_score": æ€»åˆ†(0-100),
  "dimensions": {
    "technical_quality": åˆ†æ•°,
    "innovation": åˆ†æ•°,
    "practical_value": åˆ†æ•°,
    "community_impact": åˆ†æ•°,
    "completeness": åˆ†æ•°
  },
  "strengths": ["ä¼˜ç‚¹1", "ä¼˜ç‚¹2", "ä¼˜ç‚¹3"],
  "improvements": ["æ”¹è¿›å»ºè®®1", "æ”¹è¿›å»ºè®®2"],
  "summary": "æ€»ä½“è¯„ä»·å’Œå»ºè®®",
  "recommended_tokens": å»ºè®®çš„PoLä»£å¸å¥–åŠ±æ•°é‡(0-1000)
}`;

            const response = await fetch(DEEPSEEK_API_URL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${DEEPSEEK_API_KEY}`
                },
                body: JSON.stringify({
                    model: 'deepseek-chat',
                    messages: [
                        {
                            role: 'system',
                            content: 'ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„åŒºå—é“¾å’Œå¼€æºç¤¾åŒºè´¡çŒ®è¯„å®¡ä¸“å®¶ï¼Œèƒ½å¤Ÿå®¢è§‚ã€å…¬æ­£åœ°è¯„ä¼°æŠ€æœ¯è´¡çŒ®çš„è´¨é‡å’Œä»·å€¼ã€‚è¯·å§‹ç»ˆä»¥JSONæ ¼å¼è¿”å›è¯„ä¼°ç»“æœã€‚'
                        },
                        {
                            role: 'user',
                            content: prompt
                        }
                    ],
                    temperature: 0.3,
                    max_tokens: 1500
                })
            });

            if (!response.ok) {
                throw new Error(`AI APIè°ƒç”¨å¤±è´¥: ${response.status}`);
            }

            const data = await response.json();
            const content = data.choices[0].message.content;

            // å°è¯•è§£æJSON
            try {
                const jsonMatch = content.match(/\{[\s\S]*\}/);
                if (jsonMatch) {
                    return JSON.parse(jsonMatch[0]);
                } else {
                    throw new Error('æ— æ³•è§£æAIå“åº”');
                }
            } catch (parseError) {
                console.error('JSONè§£æé”™è¯¯:', parseError);
                // è¿”å›é»˜è®¤è¯„åˆ†
                return getDefaultScore();
            }
        }

        // é»˜è®¤è¯„åˆ†ï¼ˆå½“AIè§£æå¤±è´¥æ—¶ï¼‰
        function getDefaultScore() {
            return {
                overall_score: 75,
                dimensions: {
                    technical_quality: 75,
                    innovation: 70,
                    practical_value: 75,
                    community_impact: 80,
                    completeness: 75
                },
                strengths: ['è´¡çŒ®å†…å®¹å®Œæ•´', 'æè¿°è¯¦ç»†æ¸…æ™°'],
                improvements: ['å»ºè®®å¢åŠ æ›´å¤šæŠ€æœ¯ç»†èŠ‚'],
                summary: 'AIè§£æå¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤è¯„åˆ†ã€‚å»ºè®®æ‰‹åŠ¨å®¡æ ¸ã€‚',
                recommended_tokens: 300
            };
        }

        // æ˜¾ç¤ºAIæ€è€ƒçŠ¶æ€
        function showAIThinking() {
            const placeholder = document.getElementById('judgePlaceholder');
            const content = document.getElementById('judgeContent');

            placeholder.innerHTML = `
                <div class="ai-thinking">
                    <div class="flex flex-col items-center">
                        <div class="loading-spinner mb-4"></div>
                        <p class="text-cyan-400 font-semibold mb-2">AIæ­£åœ¨è¯„å®¡ä¸­...</p>
                        <p class="text-sm text-gray-400">åˆ†æè´¡çŒ®è´¨é‡ã€æŠ€æœ¯æ°´å¹³å’Œç¤¾åŒºå½±å“</p>
                        <div class="mt-4 space-y-2 text-left w-full">
                            <div class="text-xs text-gray-500">âœ“ æŠ€æœ¯è´¨é‡è¯„ä¼°</div>
                            <div class="text-xs text-gray-500">âœ“ åˆ›æ–°æ€§åˆ†æ</div>
                            <div class="text-xs text-gray-500">âœ“ å®ç”¨ä»·å€¼åˆ¤æ–­</div>
                            <div class="text-xs text-gray-500">âœ“ ç¤¾åŒºå½±å“è¯„ä¼°</div>
                            <div class="text-xs text-gray-500">â— ç”Ÿæˆæœ€ç»ˆæŠ¥å‘Š...</div>
                        </div>
                    </div>
                </div>
            `;
            placeholder.classList.remove('hidden');
            content.classList.add('hidden');
        }

        // æ˜¾ç¤ºAIè¯„å®¡ç»“æœ
        function displayAIResult(result) {
            const placeholder = document.getElementById('judgePlaceholder');
            const content = document.getElementById('judgeContent');

            placeholder.classList.add('hidden');
            content.classList.remove('hidden');

            const scoreColor = result.overall_score >= 90 ? 'text-green-400' :
                              result.overall_score >= 70 ? 'text-blue-400' :
                              result.overall_score >= 50 ? 'text-yellow-400' : 'text-red-400';

            content.innerHTML = `
                <div class="space-y-6">
                    <!-- æ€»åˆ†æ˜¾ç¤º -->
                    <div class="text-center">
                        <div class="score-circle mx-auto mb-4">
                            <svg width="120" height="120">
                                <circle cx="60" cy="60" r="50" class="bg"></circle>
                                <circle cx="60" cy="60" r="50" class="progress"
                                        style="stroke: ${result.overall_score >= 90 ? '#10b981' : result.overall_score >= 70 ? '#3b82f6' : result.overall_score >= 50 ? '#eab308' : '#ef4444'}; stroke-dashoffset: ${314 - (result.overall_score / 100) * 314}"></circle>
                            </svg>
                            <div class="absolute inset-0 flex items-center justify-center">
                                <div class="text-center">
                                    <div class="text-3xl font-bold ${scoreColor}">${result.overall_score}</div>
                                    <div class="text-xs text-gray-400">æ€»åˆ†</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- åˆ†é¡¹è¯„åˆ† -->
                    <div class="space-y-3">
                        <h4 class="font-semibold text-cyan-400">åˆ†é¡¹è¯„åˆ†</h4>
                        ${Object.entries(result.dimensions).map(([key, value]) => {
                            const labels = {
                                technical_quality: 'æŠ€æœ¯è´¨é‡',
                                innovation: 'åˆ›æ–°æ€§',
                                practical_value: 'å®ç”¨ä»·å€¼',
                                community_impact: 'ç¤¾åŒºå½±å“',
                                completeness: 'å®Œæ•´æ€§'
                            };
                            return `
                                <div class="category-score flex items-center justify-between">
                                    <span class="text-sm">${labels[key]}</span>
                                    <div class="flex items-center space-x-2">
                                        <div class="w-24 bg-gray-700 rounded-full h-2">
                                            <div class="bg-gradient-to-r from-cyan-400 to-teal-400 h-2 rounded-full" style="width: ${value}%"></div>
                                        </div>
                                        <span class="text-sm font-semibold w-10 text-right">${value}</span>
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>

                    <!-- ä¼˜ç‚¹ -->
                    <div>
                        <h4 class="font-semibold text-green-400 mb-2">
                            <i class="fas fa-thumbs-up mr-1"></i>ä¼˜ç‚¹
                        </h4>
                        <ul class="space-y-1">
                            ${result.strengths.map(strength => `
                                <li class="text-sm text-gray-300 flex items-start">
                                    <i class="fas fa-check text-green-400 mr-2 mt-0.5"></i>
                                    <span>${strength}</span>
                                </li>
                            `).join('')}
                        </ul>
                    </div>

                    <!-- æ”¹è¿›å»ºè®® -->
                    <div>
                        <h4 class="font-semibold text-yellow-400 mb-2">
                            <i class="fas fa-lightbulb mr-1"></i>æ”¹è¿›å»ºè®®
                        </h4>
                        <ul class="space-y-1">
                            ${result.improvements.map(improvement => `
                                <li class="text-sm text-gray-300 flex items-start">
                                    <i class="fas fa-arrow-right text-yellow-400 mr-2 mt-0.5"></i>
                                    <span>${improvement}</span>
                                </li>
                            `).join('')}
                        </ul>
                    </div>

                    <!-- æ€»ç»“ -->
                    <div>
                        <h4 class="font-semibold text-cyan-400 mb-2">
                            <i class="fas fa-clipboard-check mr-1"></i>æ€»ä½“è¯„ä»·
                        </h4>
                        <p class="text-sm text-gray-300">${result.summary}</p>
                    </div>

                    <!-- å»ºè®®å¥–åŠ± -->
                    <div class="bg-gradient-to-r from-purple-600/20 to-pink-600/20 border border-purple-500/30 rounded-lg p-4">
                        <div class="flex items-center justify-between">
                            <span class="text-sm font-semibold text-purple-400">AIå»ºè®®å¥–åŠ±</span>
                            <span class="text-xl font-bold text-purple-400">${result.recommended_tokens} PoL</span>
                        </div>
                    </div>
                </div>
            `;
        }

        // æ˜¾ç¤ºå¾…è¯„å®¡çŠ¶æ€
        function showPendingResult() {
            const placeholder = document.getElementById('judgePlaceholder');
            const content = document.getElementById('judgeContent');

            placeholder.innerHTML = `
                <div class="text-center py-8">
                    <i class="fas fa-clock text-4xl text-yellow-400 mb-3"></i>
                    <p class="text-yellow-400 font-semibold mb-2">ç­‰å¾…ç¤¾åŒºè¯„å®¡</p>
                    <p class="text-sm text-gray-400">æ‚¨çš„è´¡çŒ®å·²æäº¤ï¼Œç­‰å¾…ç¤¾åŒºæˆå‘˜è¯„å®¡</p>
                </div>
            `;
            placeholder.classList.remove('hidden');
            content.classList.add('hidden');
        }

        // æ˜¾ç¤ºè¯„å®¡é”™è¯¯
        function showJudgeError() {
            const placeholder = document.getElementById('judgePlaceholder');
            const content = document.getElementById('judgeContent');

            placeholder.innerHTML = `
                <div class="text-center py-8">
                    <i class="fas fa-exclamation-triangle text-4xl text-red-400 mb-3"></i>
                    <p class="text-red-400 font-semibold mb-2">AIè¯„å®¡å¤±è´¥</p>
                    <p class="text-sm text-gray-400">æœåŠ¡æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·ç¨åé‡è¯•</p>
                </div>
            `;
            placeholder.classList.remove('hidden');
            content.classList.add('hidden');
        }

        // è®¡ç®—å¹¶å‘æ”¾ä»£å¸å¥–åŠ±
        function calculateAndAwardTokens(score) {
            let tokens = 0;

            if (score >= 90) {
                tokens = Math.floor(Math.random() * 200) + 400; // 400-600
            } else if (score >= 70) {
                tokens = Math.floor(Math.random() * 150) + 250; // 250-400
            } else if (score >= 50) {
                tokens = Math.floor(Math.random() * 100) + 150; // 150-250
            } else {
                tokens = Math.floor(Math.random() * 50) + 50; // 50-100
            }

            appState.balance += tokens;
            showToast(`AIè¯„å®¡å®Œæˆï¼è·å¾— ${tokens} PoL ä»£å¸å¥–åŠ±`, 'success');
        }

        // æ·»åŠ åˆ°è¯„å®¡å†å²
        function addToJudgeHistory(contribution, aiResult) {
            const historyContainer = document.getElementById('judgeHistory');

            if (appState.aiJudgments.length === 1) {
                historyContainer.innerHTML = '';
            }

            const scoreColor = aiResult.overall_score >= 90 ? 'green' :
                              aiResult.overall_score >= 70 ? 'blue' :
                              aiResult.overall_score >= 50 ? 'yellow' : 'red';

            const historyItem = `
                <div class="p-4 bg-gray-700/50 rounded-lg border border-gray-600">
                    <div class="flex justify-between items-start mb-2">
                        <div>
                            <h4 class="font-medium">${contribution.title}</h4>
                            <p class="text-xs text-gray-400">${new Date().toLocaleString('zh-CN')}</p>
                        </div>
                        <div class="text-right">
                            <div class="text-lg font-bold text-${scoreColor}-400">${aiResult.overall_score}åˆ†</div>
                            <div class="text-xs text-gray-400">${contributionTypes[contribution.type]}</div>
                        </div>
                    </div>
                    <div class="flex items-center justify-between">
                        <span class="text-xs text-gray-400">AIè¯„å®¡ID: ${contribution.id}</span>
                        <button onclick="viewJudgeDetail(${contribution.id})" class="text-xs text-cyan-400 hover:text-cyan-300">
                            æŸ¥çœ‹è¯¦æƒ… â†’
                        </button>
                    </div>
                </div>
            `;

            historyContainer.insertAdjacentHTML('afterbegin', historyItem);
        }

        // æŸ¥çœ‹è¯„å®¡è¯¦æƒ…
        function viewJudgeDetail(contributionId) {
            const contribution = appState.contributions.find(c => c.id === contributionId);
            if (contribution && contribution.aiResult) {
                displayAIResult(contribution.aiResult);
                document.getElementById('aiJudgeResult').scrollIntoView({ behavior: 'smooth' });
            }
        }

        // æ›´æ–°å¹³å‡åˆ†
        function updateAvgScore() {
            if (appState.aiJudgments.length === 0) {
                appState.avgScore = 0;
                return;
            }

            const totalScore = appState.aiJudgments.reduce((sum, judge) => sum + judge.overall_score, 0);
            appState.avgScore = Math.round(totalScore / appState.aiJudgments.length);
        }

        // æ¸…ç©ºè¡¨å•
        function clearForm() {
            document.getElementById('contributionTitle').value = '';
            document.getElementById('contributionDesc').value = '';
            document.getElementById('techStack').value = '';
            document.getElementById('contributionLink').value = '';
            document.getElementById('expectedImpact').value = '';
            document.querySelector('input[name="contributionType"][value="education"]').checked = true;
            updateContributionTypeCards();
        }

        // UIæ›´æ–°
        function updateUI() {
            document.getElementById('polBalance').textContent = appState.balance;
            document.getElementById('aiJudgments').textContent = appState.aiJudgments.length;
            document.getElementById('totalJudged').textContent = appState.totalJudged;
            document.getElementById('avgScore').textContent = appState.avgScore;
        }

        // å·¥å…·å‡½æ•°
        function simulateAsync(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        function showToast(message, type = 'info') {
            const toastContainer = document.getElementById('toastContainer');
            const toastId = 'toast-' + Date.now();

            const bgClass = type === 'success' ? 'bg-green-600' :
                           type === 'error' ? 'bg-red-600' :
                           type === 'warning' ? 'bg-yellow-600' : 'bg-blue-600';

            const icon = type === 'success' ? 'check-circle' :
                        type === 'error' ? 'exclamation-circle' :
                        type === 'warning' ? 'exclamation-triangle' : 'info-circle';

            const toastHTML = `
                <div id="${toastId}" class="success-toast ${bgClass} text-white px-6 py-4 rounded-lg shadow-lg flex items-center space-x-3 min-w-[300px]">
                    <i class="fas fa-${icon} text-xl"></i>
                    <span>${message}</span>
                </div>
            `;

            toastContainer.insertAdjacentHTML('beforeend', toastHTML);

            setTimeout(() => {
                const toast = document.getElementById(toastId);
                if (toast) {
                    toast.style.opacity = '0';
                    toast.style.transform = 'translateX(100%)';
                    setTimeout(() => toast.remove(), 300);
                }
            }, 3000);
        }
    </script>
</body>
</html>
